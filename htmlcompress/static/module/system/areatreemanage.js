define(function(require,exports,module){function e(){c.system.areaManage.getAreaMaxId(function(e){s=e.result>0?parseInt(e.data[0].id,10)+1:1})}function n(e,n,t,a){c.system.areaManage.updateArea(t.id,t.name,function(e){})}function t(e,n,t){t||"button"==e.target.tagName.toLowerCase()||0!=$(e.target).parents("a").length?t&&!t.noR&&(u.selectNode(t),a("node",e.clientX,e.clientY)):(u.cancelSelectedNode(),a("root",e.clientX,e.clientY))}function a(e,n,t){$("#rMenu ul").show(),"root"==e?($("#update-name").hide(),$("#delete-tag").hide()):($("#update-name").show(),$("#delete-tag").show()),g.css({top:t+"px",left:n+"px",visibility:"visible"}),$("body").bind("mousedown",o)}function i(){g&&g.css({visibility:"hidden"}),$("body").unbind("mousedown",o)}function o(e){"rMenu"==e.target.id||$(e.target).parents("#rMenu").length>0||g.css({visibility:"hidden"})}function d(){i();var n=null;u.getSelectedNodes()[0]?(n={name:"新增标签",area_parent:u.getSelectedNodes()[0].id,id:s},console.log(u.getSelectedNodes()[0]),u.addNodes(u.getSelectedNodes()[0],n)):(n={name:"新增标签",area_parent:0,id:s},u.addNodes(null,n)),c.system.areaManage.insertArea(JSON.stringify(n),function(n){n.result>0?(e(),layer.msg(" 添 加 成 功 ！",{icon:1,time:1200})):layer.msg(" 添 加 失 败 ！",{icon:2,time:1200})})}function r(){i();var e=$.fn.zTree.getZTreeObj("treeDemo"),n=u.getSelectedNodes(),t=e.transformToArray(n[0]);n&&n.length>0&&(n[0].children&&n[0].children.length,u.removeNode(n[0]));for(var a=t.length,o=[],d=0;d<a;d++)o.push(t[d].id);c.system.areaManage.deleteArea(o.join(","),function(e){})}function l(){i();var e=$.fn.zTree.getZTreeObj("treeDemo"),n=e.getSelectedNodes(),t=n[0];if(0==n.length)return void alert("请先选择一个节点");e.editName(t)}var c=require("../../common/api"),s=0;e();var u,g,m={edit:{enable:!0,showRemoveBtn:!1,showRenameBtn:!1},view:{dblClickExpand:!1},check:{enable:!0},callback:{onRightClick:t,onRename:n},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"area_parent",rootPId:0}}},f=null;c.system.areaManage.getAllArea(function(e){f=e.data,$.fn.zTree.init($("#treeDemo"),m,f),u=$.fn.zTree.getZTreeObj("treeDemo"),g=$("#rMenu")}),$("#add-tag").unbind("click").click(function(){d()}),$("#update-name").unbind("click").click(function(){l()}),$("#delete-tag").unbind("click").click(function(){r()})});