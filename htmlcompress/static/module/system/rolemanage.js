define(function(require,exports,module){function e(){u.system.roleManage.getAllRole(function(t){if(0===t.result)layer.msg(" 数 据 为 空 ！"),$(".main-context-left .list-group").empty();else{for(var i=t.data,a=t.data.length,l=[],o=0;o<a;o++)l.push('<li class="list-group-item" role-name = "'+i[o].role_name+'"  role-id = "'+i[o].id+'">'+i[o].role_name+'<span class="glyphicon glyphicon-trash span-icon-cursor delete-role span-red tooltip-show" data-toggle="tooltip" data-placement="left" title="删 除"></span></li>');$(".main-context-left .list-group").empty(),$(".main-context-left .list-group").append(l.join("")),$(".tooltip-show").tooltip(),$(".main-context-left .list-group .list-group-item").click(function(){$(".main-context-left .list-group .list-group-item").removeClass("activeli"),$(this).addClass("activeli"),c=$(this).attr("role-id"),r=$(this).attr("role-name"),n($(this).attr("role-id")),s($(this).attr("role-id"))}),$(".main-context-left .list-group .list-group-item:first").trigger("click"),$(".delete-role").unbind("click").click(function(){var n=$(this).parent().attr("role-id");u.system.roleManage.deleteRole(n,function(n){n.result?(e(),layer.msg(" 删 除 成 功 ",{icon:1,time:1200})):layer.msg(" 删 除 失 败 ",{icon:2,time:1200})})})}})}function n(e){u.system.roleManage.getSingleRole(e,function(n){var i=n.data,a=n.data.length;$(".purview-show").empty();for(var s=[],l=0;l<a;l++){var o=i[l],c=i[l].length;s.push('<div class="ui vertical segment"><div class="first_menu_show">'+o[0].menu_first_name+":</div><div>");for(var r=0;r<c;r++)""===o[r].judge_menu_id?s.push(' <span class="label label-danger change-status  span-label first span-icon-cursor" menu-pid ="'+o[r].menu_pid+'" menu-purview ="0"  menu-id="'+o[r].menu_id+'">'+o[r].menu_name+'&nbsp;&nbsp;<span class="glyphicon glyphicon-remove"></span></span>'):s.push(' <span class="label label-success change-status span-label first span-icon-cursor" menu-pid ="'+o[r].menu_pid+'"  menu-purview ="1" menu-id="'+o[r].menu_id+'">'+o[r].menu_name+'&nbsp;&nbsp;<span class="glyphicon glyphicon-ok"></span></span>');s.push("</div></div>")}$(".purview-show").append(s.join("")),$(".change-status").unbind("click").click(function(){t(e,$(this).attr("menu-id"),$(this).attr("menu-pid"),$(this).attr("menu-purview")),"0"==$(this).attr("menu-purview")?($(this).removeClass("label-danger"),$(this).addClass("label-success"),$(this).find("span").removeClass("glyphicon-remove"),$(this).find("span").addClass("glyphicon-ok"),$(this).attr("menu-purview","1")):($(this).removeClass("label-success"),$(this).addClass("label-danger"),$(this).find("span").removeClass("glyphicon-ok"),$(this).find("span").addClass("glyphicon-remove"),$(this).attr("menu-purview","0"))})})}function t(e,n,t,i){u.system.roleManage.changeRole(e,n,t,i,function(e){0===e.result&&layer.msg(" 添 加 失 败",{icon:2,time:1200})})}function i(n){u.system.roleManage.insertRole(n,function(n){n.result>0?layer.msg(" 添 加 成 功",{icon:1,time:1200,success:function(n,t){e()}}):layer.msg(" 添 加 失 败",{icon:2,time:1200})})}function a(n,t){u.system.roleManage.updateRoleName(n,t,function(n){n.result>0?(layer.close(o),layer.msg(" 修 改 成 功",{icon:1,time:1200,success:function(n,t){e()}})):layer.msg(" 修 改 失 败",{icon:2,time:1200})})}function s(e){u.system.roleManage.getUserRole(e,function(e){if(e.result>0){var n=e.data.length;$(".user-number strong").text(n)}else $(".user-number strong").text("0")})}var l,o,c,r,u=require("../../common/api");window.parent.SYSTEM;e(),$("#add-role").unbind("click").click(function(){l=layer.open({title:"添 加 角 色",type:1,area:["30%","60%"],content:$("#add-role-ialog")})}),$("#update-role").unbind("click").click(function(){""===$("#update-role-name").val()?layer.msg(" 值 不 可 为 空 "):a(c,$("#update-role-name").val())}),$("#cancel-update-role").click(function(){layer.close(o)}),$("#cancel-post-role").click(function(){layer.close(l)}),$("#open-update-dialog").unbind("click").click(function(){$("#update-role-name").val(r),o=layer.open({title:"修 改 角 色 名 称",type:1,area:["30%","40%"],content:$("#update-role-dialog")})}),$(".module-context .glyphicon-plus").click(function(){var e=[];e.push('<div class="module-context animated zoomIn">'),e.push('<input type="text" class="form-control role-name" placeholder="角色名称">'),e.push('<div class="operationicon">'),e.push('<span class="glyphicon glyphicon-trash span-icon span-icon-cursor delete-module span-red"></span>'),e.push("</div>"),e.push('<div style="clear: both"></div>'),e.push("</div>"),$("#add-role-ialog .context").append(e.join("")),$(".delete-module").click(function(){$(this).parent().parent().addClass("animated zoomOut");var e=this;setTimeout(function(){$(e).parent().parent().remove()},500)})}),$("#post-role").unbind("click").click(function(){var e=[];$(".role-name").each(function(){e.push($(this).val())}),i(JSON.stringify(e)),layer.close(l)})});