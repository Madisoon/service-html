define(function(require,exports,module){function e(e,n,a){e?($("#dep-no").val(n),$("#dep-name").val(a)):($("#dep-no").val(""),$("#dep-name").val(""))}function n(){l.system.depManage.getAllDep(function(a){$(".main-context").empty();for(var t=a.data,d=a.data.length,r=[],c=0;c<d;c++)r.push('<div class="single-member-card dep-card">'),r.push('<div class="card-info">'),r.push("<h4>"+t[c].dep_name+"</h4>"),r.push("<h5>编号:"+t[c].dep_no+"</h5>"),r.push("<h5>时间:"+t[c].dep_createtime.substring(0,10)+"</h5>"),r.push("</div>"),r.push('<div class="card-touch">'),r.push('<span  class="glyphicon glyphicon-repeat span-blue span-icon update-span" data-toggle="tooltip" data-placement="top" title="修 改" dep-no = "'+t[c].dep_no+'"  dep-id = "'+t[c].id+'"  dep-name = "'+t[c].dep_name+'"></span>'),r.push('<span class="glyphicon glyphicon-user span-yellow span-icon look-span" data-toggle="tooltip" data-placement="top" title="查 看" dep-no = "'+t[c].dep_no+'"  dep-id = "'+t[c].id+'"  dep-name = "'+t[c].dep_name+'"></span>'),r.push('<span class="glyphicon glyphicon-trash span-red span-icon delete-span" data-toggle="tooltip" data-placement="top" title="删 除" dep-no = "'+t[c].dep_no+'"  dep-id = "'+t[c].id+'"  dep-name = "'+t[c].dep_name+'"></span>'),r.push("</div>"),r.push("</div>");$(".main-context").append(r.join("")),$(".card-touch span").tooltip(),$(".delete-span").click(function(){var e=$(this).attr("dep-id");l.system.depManage.deleteDep(e,function(e){e.result?(n(),layer.msg(" 删 除 成 功",{icon:1,time:1200})):layer.msg(" 删 除 失 败",{icon:2,time:1200})})}),$(".look-span").click(function(){p($(this).attr("dep-no")),o=layer.open({title:$(this).attr("dep-name")+" 人员管理",type:1,area:["60%","60%"],maxmin:!0,content:$(".look-dep-user")})}),$(".update-span").click(function(){i=$(this).attr("dep-id"),s=!1,e(!0,$(this).attr("dep-no"),$(this).attr("dep-name")),o=layer.open({title:" 添 加 部 门",type:1,area:["45%","60%"],content:$(".add-dep-form")})})})}function a(e,a){l.system.depManage.postDepData(e,a,function(e){1==e.result?(n(),layer.msg(" 添 加 成 功",{icon:1,time:1200})):layer.msg(" 添 加 失 败",{icon:2,time:1200})})}function t(e,a,t){l.system.depManage.updateDep(e,a,t,function(e){1==e.result?(n(),layer.msg(" 修 改 成 功",{icon:1,time:1200})):layer.msg(" 修 改 失 败",{icon:2,time:1200})})}function p(e){l.system.depManage.getUserByDepNo(e,function(e){if(0==e.result)$(".look-dep-user .people_number label").text("0"),$(".look-dep-user span").remove();else{var n=e.data,a=e.data.length;$(".look-dep-user .people_number label").text(a);var t=[];$(".look-dep-user span").remove();for(var p=0;p<a;p++)t.push('<span class="label dep-user-show span-label label-primary">'),t.push(n[p].user_name+'&nbsp;&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-remove span-icon-cursor user_delete" user-loginname="'+n[p].user_loginname+'"></span>'),t.push("</span>");$(".look-dep-user").append(t.join("")),$(".user_delete").click(function(){var e={user_loginname:$(this).attr("user-loginname"),user_dep:""};l.system.userManage.updateUserInfo(JSON.stringify(e),function(e){1==e.result?layer.msg(" 修 改 成 功 ",{icon:1,time:1200,success:function(){}}):layer.msg(" 修 改 失 败",{icon:2,time:1200})}),$(this).parent().addClass("animated zoomOutDown");var n=parseInt($(".look-dep-user .people_number label").text(),10)-1;$(".look-dep-user .people_number label").text(n);var a=this;setTimeout(function(){$(a).parent().remove()},700)})}})}var s,o,l=require("../../common/api"),i=(window.parent.SYSTEM,"");n(),$("#add-dep").click(function(){s=!0,e(!1,"",""),o=layer.open({title:" 添 加 部 门",type:1,area:["45%","60%"],maxmin:!0,content:$(".add-dep-form")})}),$("#post-dep").click(function(){""===$("#dep-name").val()||""===$("#dep-no").val()?layer.msg(" 值 不 可 为 空 "):(s?a($("#dep-name").val(),$("#dep-no").val()):t($("#dep-name").val(),$("#dep-no").val(),i),layer.close(o))}),$("#cancel-dep").click(function(){layer.close(o)}),$(document).keypress(function(e){13==e.charCode&&$("#post-dep").trigger("click")})});