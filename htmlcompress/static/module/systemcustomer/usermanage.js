define(function(require,exports,module){function e(e,a,t){for(var r=$.fn.zTree.getZTreeObj("treeDemo"),i=r.getCheckedNodes(!0),o=i.length,n=[],l=0;l<o;l++)"valname"in i[l]&&n.push(' <li><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;'+i[l].valname+"</li>");$(".purview-user").empty(),$(".purview-user").append(n.join(""))}function a(e){if(d=[],d.push({checkbox:!0}),d.push({field:"customer_name",title:"客户名称",sortable:!0}),d.push({field:"base_user_name",title:"用户名称",sortable:!0}),d.push({field:"base_start_time",title:"开始时间",sortable:!0,formatter:function(e,a,t){return e.substring(0,10)}}),d.push({field:"base_end_time",title:"结束时间",sortable:!0,formatter:function(e,a,t){return e.substring(0,10)}}),1==e.result){for(var a=e.data,t=e.data.length,r=0;r<t;r++){var o={field:"",title:"",sortable:!0};o.field=a[r].field_name,o.title=a[r].field_title,d.push(o)}d.push({field:"customer_status",title:"客户状态",sortable:!0}),$("thead").remove(),$("#user-table").bootstrapTable({columns:d,pageNumber:1,pageSize:12,dataField:"data",undefinedText:"--",showColumns:"true",sidePagination:"server",classes:"table table-bordered table-hover",method:"post",formatSearch:function(){return"任意搜索"},url:u.baseUrl+"/getAllCustom",queryParamsType:"undefined",queryParams:function(e){return{pageNumber:e.pageNumber,pageSize:e.pageSize,choiceSelect:m}},pagination:!0,paginationHAlign:"left",paginationDetailHAlign:"right",onClickRow:function(e){i(e)},onLoadSuccess:function(e){}})}}function t(e){for(var a=e.data,t=a.length,i={},o=0,n=0;n<t;n++)if("user_purview"!=a[n].field_name){if(""===$(".choice"+a[n].field_name).val())continue;o=1,i[a[n].field_name]=$(".choice"+a[n].field_name).val()}m=1==o?i:"",$("#user-table").bootstrapTable("destroy"),r("table")}function r(e){u.customManage.userManage.getFieldName(function(r){"table"==e?a(r):t(r)})}function i(e){u.customManage.fieldManage.getAllField("nokind",function(a){var t=a.data,r=a.data.length;c=new $.fieldshow.init(t,r,e);var i=c.writeDom();if($(".custom-detail-form .otherField").empty(),$(".custom-detail-form .otherField").append(i),$(".datepicker-controller").datetimepicker({format:"Y-m-d",timepicker:!1}),""===e)p="0";else{p=e.id;for(var o in e)if("user_province"!=o&&"user_city"!=o&&"user_country"!=o)if($(".form-group ."+o+" ").parent().hasClass("radio-inline"))$(".form-group ."+o+' [value = "'+e[o]+'"]').prop("checked",!0);else if($(".form-group ."+o+" ").parent().hasClass("checkbox-inline"))for(var l=e[o].split(","),s=l.length,u=0;u<s;u++)$(".form-group ."+o+' [value = "'+l[u]+'"]').prop("checked",!0);else $(".form-group ."+o+" ").val(e[o]);$(".form-control.base-user-name").val(e.base_user_name),$(".form-control.base-start-time").val(e.base_start_time),$(".form-control.base-end-time").val(e.base_end_time),$("#customer-id").val(e.custom_name_id),$(".purview-user").empty(),$(".form-control.user-purview").val(e.user_purview);var d={user_province:e.user_province,user_city:e.user_city,user_country:e.user_country};""!=d.user_province&&""!=d.user_city?h.assignmentSelect(d):($("#first-area-update").val(""),$("#second-area-update").val(""),$("#third-area-update").val(""));var m=$.fn.zTree.getZTreeObj("treeDemo");if(m.checkAllNodes(!1),""!=e.user_purview){for(var f=e.user_purview.split(","),b=f.length,g=[],u=0;u<b;u++){var v=m.getNodeByParam("valname",f[u]);m.selectNode(v),m.checkNode(v,!0,!0),m.updateNode(v),g.push(' <li><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;'+f[u]+"</li>")}$(".purview-user").append(g.join(""))}}n=layer.open({title:" 客 户 信 息 管 理 ",type:1,area:["60%","90%"],shadeClose:!0,zIndex:99,content:$("#custom-detail")}),0==a.result&&layer.msg(" 数 据 为 空",{icon:2,time:1200})})}function o(e){$("#all-customer").bootstrapTable("destroy"),$("#all-customer").bootstrapTable({columns:d,pageNumber:1,pageSize:12,search:!0,dataField:"data",undefinedText:"--",showColumns:"true",classes:"table table-bordered table-hover",method:"post",formatSearch:function(){return"任意搜索"},url:u.baseUrl+"/getAllCustomerById",queryParamsType:"undefined",queryParams:function(a){return{pageNumber:a.pageNumber,pageSize:a.pageSize,customerId:e}},pagination:!0,paginationHAlign:"left",paginationDetailHAlign:"right"})}var n,l,s,u=require("../../common/api"),c={},d=[],p="0",m="",f=!1;$.datetimepicker.setLocale("zh"),$(".field-choice").hide(),$(".field-choice-area").hide();var b={id:"area-field-show",areaProvince:"",areaCity:"",areaCounty:"",fieldStyle:""},g={id:"field-choice-area",areaProvince:"",areaCity:"",areaCounty:"",fieldStyle:"horizontal"},h=new $.areaFieldShow.init(b);h.writeAreaFieldDom(),new $.areaFieldShow.init(g).writeAreaFieldDom(),function(){u.customManage.userManage.getDeparmentUser(function(e){var a=e.data;$.fn.zTree.init($("#treeDemo"),v,a)})}(),r("table"),function(){u.customManage.fieldManage.getAllField("nokind",function(e){var a=e.data,t=e.data.length,r=new $.fieldshow.init(a,t,""),i=r.writeChoiceDom();$(".field-choice form").append(i)})}();var v={check:{enable:!0},data:{simpleData:{enable:!0}},callback:{onCheck:e}};v.check.chkboxType={Y:"ps",N:"ps"},$("#showAllCustomer").click(function(){$("#user-table").bootstrapTable("destroy"),f=!f,f?($(".field-choice").fadeOut(),$(".field-choice-area").fadeOut(),$("#showChoice").prop("disabled",!0),$("#deleteData").prop("disabled",!0),$("#selectData").prop("disabled",!0),$("#user-table").bootstrapTable({columns:d,pageNumber:1,pageSize:12,dataField:"data",undefinedText:"--",showColumns:"true",sidePagination:"server",classes:"table table-bordered table-hover",method:"post",formatSearch:function(){return"任意搜索"},url:u.baseUrl+"/getAllCustomGroup",queryParamsType:"undefined",queryParams:function(e){return{pageNumber:e.pageNumber,pageSize:e.pageSize}},pagination:!0,paginationHAlign:"left",paginationDetailHAlign:"right",onClickRow:function(e){o(e.custom_name_id),s=layer.open({title:" 客 户 所 有 者 管 理 ",type:1,area:["80%","90%"],shadeClose:!0,content:$("#allCustomerShow")})},onLoadSuccess:function(e){}})):($("#showChoice").prop("disabled",!1),$("#deleteData").prop("disabled",!1),$("#selectData").prop("disabled",!1),$("#user-table").bootstrapTable({columns:d,pageNumber:1,pageSize:12,dataField:"data",undefinedText:"--",showColumns:"true",sidePagination:"server",classes:"table table-bordered table-hover",method:"post",formatSearch:function(){return"任意搜索"},url:u.baseUrl+"/getAllCustom",queryParamsType:"undefined",queryParams:function(e){return{pageNumber:e.pageNumber,pageSize:e.pageSize,choiceSelect:m}},pagination:!0,paginationHAlign:"left",paginationDetailHAlign:"right",onClickRow:function(e){i(e)},onLoadSuccess:function(e){}}))}),$("#custom-purview-cancel").click(function(){layer.close(l)}),$("#custom-purview-post").click(function(){for(var e=$.fn.zTree.getZTreeObj("treeDemo"),a=e.getCheckedNodes(!0),t=a.length,r=[],i=0;i<t;i++)"valname"in a[i]&&r.push(""+a[i].valname);$(".user-purview").val(r.join(",")),layer.close(l)}),$(".form-control.user-purview").focus(function(){l=layer.open({title:" 客 户 所 有 者 管 理 ",type:1,area:["35%","100%"],shadeClose:!0,content:$("#custom-purview"),zIndex:layer.zIndex,success:function(e){layer.setTop(e)}})}),$("#reserve-button").unbind("click").click(function(){var e={user_purview:$(".form-control.user-purview").val()},a=$("#customer-id").val();h.getAreaFieldValue(),c.postCustomData(p,h.getAreaFieldValue(),e,a,function(e){layer.close(n)}),$("#user-table").bootstrapTable("refresh",null)}),$("#cancel-button").unbind("click").click(function(){layer.close(n)}),$("#showChoice").unbind("click").click(function(){$(".field-choice").fadeToggle(),$(".field-choice-area").fadeToggle()}),$("#selectData").unbind("click").click(function(){r("choice")}),$("#addData").unbind("click").click(function(){i("")}),u.customManage.customerManage.getAllCustomer(function(e){var a=e.data,t=a.length,r=[];r.push('<option value="">请选择客户</option>');for(var i=0;i<t;i++)r.push('<option value="'+a[i].id+'">'+a[i].customer_name+"</option>");$("#customer-id").empty(),$("#customer-id").append(r.join(""))}),$("#deleteData").unbind("click").click(function(){var e=$("#user-table").bootstrapTable("getSelections",null),a=e.length,t=[];if(0===a)layer.msg(" 没 有 选 中 任 何 数 据 ");else{for(var r=0;r<a;r++)t.push(e[r].id);$.deleteData({id:t.join("@"),url:"../deleteCustom",deleteCallBack:function(){$("#user-table").bootstrapTable("refresh",null)}})}})});