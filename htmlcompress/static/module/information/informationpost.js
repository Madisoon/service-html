define(function(require,exports,module){function a(){var n=$("#user-loginname").val();t.information.infoManualShow.getInforPost(n,i,function(n){if(0===n.result)$(".info-show-context").empty();else{for(var e=n.data,i=e.length,r=[],l=0;l<i;l++){var s="";switch(r.push('<div class="info-context-item">'),r.push('<div class="info-context word">'+e[l].infor_context.substring(0,20)+"</div>"),r.push('<div class="info-time word">'+e[l].infor_post_time.substring(0,16)+"</div>"),e[l].infor_post_type){case"qq":s="QQ";break;case"qqGroup":s="QQ群";break;case"weixin":s="微信";break;case"weixinGroup":s="微信群"}r.push('<div class="info-type word">'+s+"</div>"),r.push('<div class="info-post word">'+e[l].infor_post_people+"--"+e[l].number_name.substring(0,5)+"</div>"),r.push('<div class="info-get word">'+e[l].infor_get_people+"--"+e[l].get_remark+"</div>"),r.push('<div class="info-operate word">');var c=e[l].infor_context.replace(/\"/g,"”");r.push('<button type="button" data-clipboard-text="'+c+'" class="btn btn-primary">复制</button>'),r.push('<button type="button" class="btn btn-danger" inforId="'+e[l].id+'">删除</button>'),r.push('<button type="button" class="btn btn-success post" inforId="'+e[l].id+'">完成</button>'),r.push("</div></div>")}$(".info-show-context").empty(),$(".info-show-context").append(r.join(""));new Clipboard(".btn-primary");$(".btn-primary").click(function(){$(".btn-primary").parent().parent().removeClass("active"),$(this).parent().parent().addClass("active")}),$(".btn-success.post").on("click",function(){var n=$(this).attr("inforId");$(this).parent().parent().remove(),t.information.infoManualShow.updateInforPost(n,o.user.user_loginname,function(n){$(".info-context-item").length<20&&a()})}),$(".btn-danger").on("click",function(){var a=$(this).attr("inforId");$(this).parent().parent().remove(),t.information.infoManualShow.deleteInforPost(a,function(a){})})}})}function n(){var a={},n={};n.infor_title=$(".form-control.infor-title").val(),n.infor_context=$(".form-control.infor-context").val().replace(/\'/g,"‘"),n.infor_type=$("input[name=type-radio]:checked").val(),n.infor_grade=$("input[name=grade-radio]:checked").val(),n.infor_link=$(".form-control.infor-link").val(),n.infor_site=$(".form-control.infor-site").val(),n.infor_status="0",n.infor_source=$("input[name=info-resource]:checked").val(),n.infor_creater=o.user.user_loginname;var e=[];return $(".tag .label").each(function(){e.push($(this).attr("tag-id"))}),a.infor=n,a.inforTag=e,a}function e(a,n){if(s.tagOperation.writeTagData(!1,"","tag-tree"),n)$("#id_select > option").attr("select",!1),$(".dropdown-menu.inner.selectpicker li").removeClass("selected active"),console.log("shengxiao"),$(".filter-option.pull-left").text(""),$(".form-control.infor-title").val(""),$(".form-control.infor-context").val(""),$("input[name=type-radio][value = 0]").prop("checked",!0),$("input[name=grade-radio][value = 3]").prop("checked",!0),$(".form-control.infor-link").val(""),$(".form-control.infor-site").val(""),$(".tag").empty(),$(".my-tag-show .label").removeClass("label-primary"),$(".my-tag-show .label").addClass("label-danger"),$(".my-tag-show .label").children("span").removeClass("glyphicon-ok"),$(".my-tag-show .label").children("span").addClass("glyphicon-arrow-up");else{$(".my-tag-show .label").removeClass("label-primary"),$(".my-tag-show .label").addClass("label-danger"),$(".my-tag-show .label").children("span").removeClass("glyphicon-ok"),$(".my-tag-show .label").children("span").addClass("glyphicon-arrow-up"),$(".form-control.infor-title").val(a.infor_title),$(".form-control.infor-context").val(a.infor_context),$("input[name=info-resource][value="+a.infor_source+"]").prop("checked",!0),$("input[name=type-radio][value = "+a.infor_type+"]").prop("checked",!0),$("input[name=grade-radio][value = "+a.infor_grade+"]").prop("checked",!0),$(".form-control.infor-link").val(a.infor_link),$(".form-control.infor-site").val(a.infor_site);for(var e=a.tag_ids.split(","),t=a.tag_names.split(","),o=e.length,i=[],r=0;r<o;r++)i.push('<span class="label  label-warning span-icon-cursor" tag-id="'+e[r]+'">'+t[r]+"&nbsp;&nbsp;"),i.push('<span class="glyphicon glyphicon-remove"></span></span>'),$(".my-tag-show .label[tag-id = "+e[r]+"]").removeClass("label-danger"),$(".my-tag-show .label[tag-id = "+e[r]+"]").addClass("label-primary"),$(".my-tag-show .label[tag-id = "+e[r]+"]").children("span").removeClass("glyphicon-arrow-up"),$(".my-tag-show .label[tag-id = "+e[r]+"]").children("span").addClass("glyphicon-ok"),s.tagOperation.writeTagData(!0,e[r],"tag-tree");$(".tag").empty(),$(".tag").append(i.join(""))}}var t=require("../../common/api"),o=window.parent.SYSTEM,i=0;$("#search-infor-data").click(function(){a()}),$("#post-user-sort").click(function(){i=0,a()}),$("#receive-user-sort").click(function(){i=1,a()}),t.system.userManage.getAllUser(function(a){for(var n=a.data,e=[],t=0;t<a.total;t++)e.push('<option value="'+n[t].user_loginname+'">'+n[t].user_name+"</option>");$("#user-loginname").append(e.join(""))}),a();var r,l,s=require("../../common/tagshow"),o=window.parent.SYSTEM;s.tagOperation.writeDomTag(!1,"tag-tree"),$("#add-infor-btn").unbind("click").click(function(){e(null,!0),r=layer.open({title:" 新增信息 (监测信息员:"+o.user.user_name+")",type:1,area:["52%","98%"],content:$("#add-infor")})}),$("#add-other-tag").unbind("click").click(function(){l=layer.open({title:"标 签 选 择（额 外 标 签）",type:1,area:["32%","98%"],content:$("#other-tag-choose"),zIndex:layer.zIndex,success:function(a){layer.setTop(a)}})}),$("#cancel-btn").unbind("click").click(function(){$(".form-control.infor-write").val(""),layer.close(r)}),t.tag.personTag.getMyTag(o.user.user_loginname,function(a){for(var n=a.data,e=a.data.length,t=[],o=0;o<e;o++)t.push('<span class="label label-danger span-icon-cursor add" tag-id="'+n[o].id+'">'+n[o].name+'&nbsp;&nbsp;<span  class="glyphicon glyphicon-arrow-up "></span></span>');$(".my-tag-show").empty(),$(".my-tag-show").append(t.join("")),$(".my-tag-show .label").unbind("click").click(function(){var a=$(this).attr("tag-id"),n='<span class="label animated zoomIn label-warning span-icon-cursor" tag-id="'+a+'">'+$(this).text()+'&nbsp;&nbsp;<span class="glyphicon glyphicon-remove"></span></span>';0==$(".tag .label[tag-id = "+a+"]").length&&($(".tag").append(n),setTimeout(function(){$(".tag .label").removeClass("animated zoomIn")},500),$(".tag .label").unbind("click").click(function(){$(this).addClass("animated zoomOut");var a=$(this).attr("tag-id");s.tagOperation.writeTagData(!1,a,"tag-tree"),$(".my-tag-show .label[tag-id = "+a+"]").removeClass("label-primary"),$(".my-tag-show .label[tag-id = "+a+"]").addClass("label-danger"),$(".my-tag-show .label[tag-id = "+a+"]").children().removeClass("glyphicon-ok"),$(".my-tag-show .label[tag-id = "+a+"]").children().addClass("glyphicon-arrow-up");var n=this;setTimeout(function(){$(n).remove()},500)}),$(this).removeClass("label-danger"),$(this).addClass("label-primary"),$(this).children("span").removeClass("glyphicon-arrow-up"),$(this).children("span").addClass("glyphicon-ok"))})}),$("#post-btn").unbind("click").click(function(){var e=n();$(".form-control.infor-write").val("");var o=e.infor;""==o.infor_title||""==o.infor_context||""==o.infor_link||0==e.inforTag.length?layer.msg("抱歉,数据没有填写完整！",{time:1500,zIndex:layer.zIndex,success:function(a){layer.setTop(a)}}):t.information.infoShow.postInforData(o,e.inforTag.join(","),function(n){layer.close(r),1==n.result?(a(),layer.msg(" 添 加 成 功 ！",{icon:1,time:1200})):layer.msg(" 添 加 失 败 ！",{icon:2,time:1200})})}),$(".infor-write").change(function(){var a=$(".form-control.infor-write").val();$(".form-control.infor-title").val(a.substring(a.indexOf("标题:")+3,a.indexOf("内容:"))),$(".form-control.infor-context").val(a.substring(a.indexOf("内容:")+3,a.indexOf("链接:")).trim()),$(".form-control.infor-link").val(a.substring(a.indexOf("链接:")+3,a.indexOf("来源:"))),$(".form-control.infor-site").val(a.substring(a.indexOf("站点:")+3)),$("input[name=info-resource][value="+a.substring(a.indexOf("来源:")+3,a.indexOf("属性:")).trim()+"]").prop("checked",!0)}),$("#tag-cancel-btn").unbind("click").click(function(){layer.close(l)}),$("#tag-post-btn").unbind("click").click(function(){layer.close(l);var a=s.tagOperation.getTreeValue(!0,"tag-tree"),n=a.length,e=[];$(".tag .other-tag").remove();for(var t=0;t<n;t++)0==$(".tag .label[tag-id = "+a[t].id+"]").length&&e.push('<span class="label other-tag label-warning span-icon-cursor" tag-id="'+a[t].id+'">'+a[t].name+'&nbsp;&nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-remove"></span></span>');$(".tag").append(e.join("")),$(".tag .label").unbind("click").click(function(){$(this).addClass("animated zoomOut");var a=$(this).attr("tag-id");s.tagOperation.writeTagData(!1,a,"tag-tree"),$(".my-tag-show .label[tag-id = "+a+"]").removeClass("label-primary"),$(".my-tag-show .label[tag-id = "+a+"]").addClass("label-danger"),$(".my-tag-show .label[tag-id = "+a+"]").children().removeClass("glyphicon-ok"),$(".my-tag-show .label[tag-id = "+a+"]").children().addClass("glyphicon-arrow-up");var n=this;setTimeout(function(){$(n).remove()},500)})}),$(".tag","click",".label",function(){$(this).addClass("animated zoomOut");var a=$(this).attr("tag-id");s.tagOperation.writeTagData(!1,a,"tag-tree"),$(".my-tag-show .label[tag-id = "+a+"]").removeClass("label-primary"),$(".my-tag-show .label[tag-id = "+a+"]").addClass("label-danger"),$(".my-tag-show .label[tag-id = "+a+"]").children().removeClass("glyphicon-ok"),$(".my-tag-show .label[tag-id = "+a+"]").children().addClass("glyphicon-arrow-up");var n=this;setTimeout(function(){$(n).remove()},500)})});