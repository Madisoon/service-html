define(function(require,exports,module){function e(e,a,t){var n=$.fn.zTree.getZTreeObj("area-tree"),o=n.transformToArray(t);u=t.id;for(var l=o.length,c=[],i=0;i<l;i++)c.push(o[i].id);d=c,r()}function a(e,a,r){for(var t=$.fn.zTree.getZTreeObj("area-tree"),n=t.transformToArray(r),o=n.length,l=[],c=0;c<o;c++)l.push(n[c].id);i.movement.terraceManage.getAllTerraceModule(l.join(","),function(e){console.log(e);for(var a=e.data,r=e.total,t=[],n=0;n<r;n++)t.push('<label class="checkbox-inline">'),t.push('<input type="checkbox" name="moduleOptions" moduleName="'+a[n].terrace_module_name+'"  value="'+a[n].id+'">'),t.push(""+a[n].terrace_module_name),t.push("</label>");$("#search-module-name").val(""),$(".module-info").empty(),$(".module-info").append(t.join(""))})}function r(){$("#terrace-info").bootstrapTable("destroy"),$("#terrace-info").bootstrapTable({columns:[{checkbox:!0},{field:"terrace_name",searchable:!0,sortable:!0,title:"平台名称"},{field:"terrace_link",searchable:!0,title:"平台链接"},{field:"terrace_module_names",title:"模块"},{field:"terrace_time",searchable:!0,title:"创建时间"},{field:"user_name",searchable:!0,title:"创建人"}],pageNumber:1,pageSize:10,dataField:"data",undefinedText:"--",sidePagination:"client",showColumns:"true",classes:"table table-bordered table-hover",method:"post",url:i.baseUrl+"getAllTerraceCustomer",queryParamsType:"undefined",queryParams:function(e){return{pageNumber:e.pageNumber,pageSize:e.pageSize,serveTerraceSearch:m,areaId:d.join(",")}},pagination:!0,paginationHAlign:"left",paginationDetailHAlign:"right",onClickRow:function(e){console.log(e),t(e,!1),n=!1,l=layer.open({title:" 编辑平台(创建人："+e.user_name+")",type:1,area:["52%","55%"],content:$("#add-terrace")}),o=e.id,"超级管理员"===s.user.role_name?$("#post-terrace-btn").prop("disabled",!1):s.user.user_loginname===e.user_loginname?$("#post-terrace-btn").prop("disabled",!1):$("#post-terrace-btn").prop("disabled",!0)}})}function t(e,a){if(a)$(".form-control.terrace-name").val(""),$(".form-control.terrace-link").val(""),$("#terrace-module").empty();else{$(".form-control.terrace-name").val(e.terrace_name),$(".form-control.terrace-link").val(e.terrace_link);for(var r=e.terrace_module_names.split(","),t=e.module_ids.split(","),n=r.length,o=[],l=0;l<n;l++)o.push(' <span class="label other-module label-primary span-icon-cursor" module-id="'+t[l]+'">'+r[l]+"<span "),o.push(' class="glyphicon glyphicon-remove"></span></span> ');$("#terrace-module").empty(),$("#terrace-module").append(o.join("")),$("#terrace-module .other-module").unbind("click").click(function(){$(this).addClass(" animated zoomOut ");var e=this;setTimeout(function(){$(e).remove()},1e3)})}}var n,o,l,c,i=require("../../common/api"),s=window.parent.SYSTEM,u="",d=[],m={},p={callback:{onClick:e},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"area_parent",rootPId:0}}},f=null;i.system.areaManage.getAllArea(function(e){f=e.data,u=e.data[0].id,$.fn.zTree.init($("#area-tree"),p,f);var a=$.fn.zTree.getZTreeObj("area-tree"),r=a.getNodeByParam("id",e.data[0].id);a.selectNode(r),a.setting.callback.onClick(null,a.setting.treeId,r)});var b={callback:{onClick:a},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"area_parent",rootPId:0}}},h=null;i.system.areaManage.getAllArea(function(e){h=e.data,$.fn.zTree.init($("#module-area-tree"),b,h)}),$("#add-module-dialog").unbind("click").click(function(){c=layer.open({title:"选 择 模 块",type:1,area:["52%","95%"],content:$("#module-choose-dialog")})}),$("#delete-terrace-btn").unbind("click").click(function(){var e=$("#terrace-info").bootstrapTable("getSelections",null),a=e.length,t=[];if(0===a)layer.msg(" 没 有 选 中 任 何 数 据 ");else{for(var n=0;n<a;n++)t.push(e[n].id);i.movement.terraceCustomer.deleteTerraceCustomerId(t.join(","),function(e){e.result?(r(),layer.msg(" 删 除 成 功 ！",{icon:1,time:1200})):layer.msg(" 删 除 失 败 ！",{icon:2,time:1200})})}}),$("#sure-choose-module").unbind("click").click(function(){var e=$(".choose-terrace-name").val(),a=$(".choose-terrace-link").val(),t=$(".choose-terrace-create").val(),n=$(".choose-terrace-module").val(),o={};""!=e&&(o.terrace_name=e),""!=a&&(o.terrace_link=a),""!=t&&(o.user_name=t),""!=n&&(o.terrace_module_name=n),m=o,r()}),$("#search-show-btn").unbind("click").click(function(){$(".terrace-search").stop().slideToggle()}),$("#add-terrace-btn").unbind("click").click(function(){t(null,!0),$("#post-terrace-btn").prop("disabled",!1),n=!0,l=layer.open({title:" 新建平台客户(创建人："+s.user.user_name+")",type:1,area:["52%","55%"],content:$("#add-terrace")})}),$("#cancel-module-btn").unbind("click").click(function(){layer.close(c)}),$("#post-module-btn").unbind("click").click(function(){layer.close(c);var e=($("input[name=moduleOptions]:checked").val(),$("input[name=moduleOptions]:checked").attr("moduleName"),[]);$("input[name=moduleOptions]:checked").each(function(){e.push(' <span class="label other-module label-primary span-icon-cursor" '),e.push(' module-id="'+$(this).val()+'">'+$(this).attr("moduleName")+"&nbsp;&nbsp;<span "),e.push(' class="glyphicon glyphicon-remove"></span></span> ')}),$("#terrace-module").append(e.join("")),$("#terrace-module .other-module").unbind("click").click(function(){$(this).addClass(" animated zoomOut ");var e=this;setTimeout(function(){$(e).remove()},1e3)})}),$("#cancel-terrace-btn").unbind("click").click(function(){layer.close(l)}),$(".search-module").unbind("click").click(function(){}),$("#post-terrace-btn").unbind("click").click(function(){var e={terrace_name:$(".form-control.terrace-name").val(),terrace_link:$(".form-control.terrace-link").val(),terrace_create:s.user.user_loginname},a=[];$("#terrace-module .other-module").each(function(){a.push($(this).attr("module-id"))}),""===e.terrace_name||""===e.terrace_link||""===e.terrace_create||0===a.length?layer.msg("抱歉,数据没有填写完整！",{time:1500,zIndex:layer.zIndex,success:function(e){layer.setTop(e)}}):(layer.close(l),n?i.movement.terraceCustomer.insertTerraceCustomer(JSON.stringify(e),a.join(","),u,function(e){e.result?(r(),layer.msg(" 添 加 成 功 ！",{icon:1,time:1200})):layer.msg(" 添 加 失 败 ！",{icon:2,time:1200})}):(console.log(o),i.movement.terraceCustomer.updateTerraceCustomer(JSON.stringify(e),a.join(","),o,function(e){e.result?(r(),layer.msg(" 修 改 成 功 ！",{icon:1,time:1200})):layer.msg(" 修 改 失 败 ！",{icon:2,time:1200})})))}),r()});