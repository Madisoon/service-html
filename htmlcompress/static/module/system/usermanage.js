define(function(require,exports,module){function e(){return{user_loginname:$(".form-control.user_loginname").val(),user_name:$(".form-control.user_name").val(),user_phone:$(".form-control.user_phone").val(),user_dep:$(".form-control.user_dep").val(),user_role:$(".form-control.user_role").val()}}function r(e,r){e?($(".form-control.user_loginname").prop("disabled",!0),$(".form-control.user_loginname").val(r.user_loginname),$(".form-control.user_name").val(r.user_name),$(".form-control.user_phone").val(r.user_phone),$(".form-control.user_dep").val(r.user_dep),$(".form-control.user_role").val(r.user_role),$(".form-control.user_role").val(r.user_role),$(".form-control.user_password").val(""),$(".form-control.user_password_sure").val("")):($(".form-control.user_loginname").prop("disabled",!1),$(".form-control.user_loginname").val(""),$(".form-control.user_name").val(""),$(".form-control.user_phone").val(""),$(".form-control.user_password").val(""),$(".form-control.user_password_sure").val(""))}function o(e){r(!0,e),l=layer.open({title:" 用户信息管理 ",type:1,area:["60%","90%"],content:$("#userInfoDialog")})}var s,n=require("../../common/api"),l=(window.parent.SYSTEM,"");$("#user-table").bootstrapTable({columns:[{checkbox:!0},{field:"user_loginname",searchable:!0,sortable:!0,title:"账号"},{field:"user_name",searchable:!0,title:"姓名"},{field:"user_phone",searchable:!0,title:"手机号"},{field:"user_createtime",title:"创建时间"},{field:"role_name",title:"角色"},{field:"dep_name",title:"部门"}],pageNumber:1,pageSize:12,search:!0,dataField:"data",undefinedText:"--",showColumns:"true",classes:"table table-bordered table-hover",method:"post",formatSearch:function(){return"任意搜索"},url:n.baseUrl+"/getAllUser",queryParamsType:"undefined",pagination:!0,paginationHAlign:"left",paginationDetailHAlign:"right",onClickRow:function(e){s=!1,o(e)},onLoadSuccess:function(e){}}),$("#reserve-button").unbind("click").click(function(){var r=e();""==r.user_loginname||""==r.user_name||""==r.user_phone||""==r.user_dep||""==r.user_role?layer.msg("抱歉,数据没有填写完整！",{time:1500,zIndex:layer.zIndex,success:function(e){layer.setTop(e)}}):s?""==$(".form-control.user_password").val()||""==$(".form-control.user_password_sure").val()?layer.msg("抱歉,数据没有填写完整！",{time:1500,zIndex:layer.zIndex,success:function(e){layer.setTop(e)}}):$(".form-control.user_password").val()!=$(".form-control.user_password_sure").val()?layer.msg("抱歉,两次密码不一致！",{time:1500,zIndex:layer.zIndex,success:function(e){layer.setTop(e)}}):(r.user_password=$(".form-control.user_password").val(),n.system.userManage.insertSysUser(JSON.stringify(r),function(e){1==e.result?(layer.close(l),layer.msg(" 新 增 成 功 ",{icon:1,time:1200,success:function(){$("#user-table").bootstrapTable("refresh",null)}})):layer.msg(" 新 增 失 败",{icon:2,time:1200})})):""==$(".form-control.user_password").val()&&""==$(".form-control.user_password_sure").val()?n.system.userManage.updateUserInfo(JSON.stringify(r),function(e){1==e.result?(layer.close(l),layer.msg(" 修 改 成 功 ",{icon:1,time:1200,success:function(){$("#user-table").bootstrapTable("refresh",null)}})):layer.msg(" 修 改 失 败",{icon:2,time:1200})}):$(".form-control.user_password").val()!=$(".form-control.user_password_sure").val()?layer.msg("抱歉,两次密码不一致！",{time:1500,zIndex:layer.zIndex,success:function(e){layer.setTop(e)}}):(r.user_password=$(".form-control.user_password").val(),n.system.userManage.updateUserInfo(JSON.stringify(r),function(e){1==e.result?(layer.close(l),layer.msg(" 修 改 成 功 ",{icon:1,time:1200,success:function(){$("#user-table").bootstrapTable("refresh",null)}})):layer.msg(" 修 改 失 败",{icon:2,time:1200})}))}),$("#cancel-button").unbind("click").click(function(){layer.close(l)}),$("#addUserData").unbind("click").click(function(){s=!0,r(!1,""),l=layer.open({title:" 用户信息管理 ",type:1,area:["60%","90%"],content:$("#userInfoDialog")})}),$("#deleteUserData").unbind("click").click(function(){var e=$("#user-table").bootstrapTable("getSelections",null),r=e.length,o=[];if(0===r)layer.msg(" 没 有 选 中 任 何 数 据 ");else{for(var s=0;s<r;s++)o.push(e[s].id);n.system.userManage.deleteUser(o.join("@"),function(e){e.result?($("#user-table").bootstrapTable("refresh",null),layer.msg(" 删 除 成 功 ",{icon:1,time:1200})):layer.msg(" 删 除 失 败 ",{icon:2,time:1200})})}}),n.system.depManage.getAllDepRole(function(e){for(var r=(e.data,e.data.role),o=e.data.role.length,s=[],n=[],l=0;l<o;l++)s.push('<option value="'+r[l].id+'">'+r[l].role_name+"</option>");for(var a=e.data.dep,t=e.data.dep.length,l=0;l<t;l++)n.push('<option value="'+a[l].dep_no+'">'+a[l].dep_name+"</option>");$(".user_dep").append(n.join("")),$(".user_role").append(s.join(""))})});